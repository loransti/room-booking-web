<% title = 'Dashboard' %>
<div class="d-flex justify-content-between align-items-center mb-4">
  <h2 class="mb-0">Dashboard</h2>
  <div class="text-muted">Timezone: <%= process.env && process.env.TIMEZONE ? process.env.TIMEZONE : 'Configured' %></div>
  
</div>

<div class="row g-3 mb-4">
  <div class="col-md-3">
    <div class="card p-3">
      <div class="text-muted">Total Bookings</div>
      <div class="h3 mb-0"><%= stats.totalBookings %></div>
    </div>
  </div>
  <div class="col-md-3">
    <div class="card p-3">
      <div class="text-muted">Active/Upcoming</div>
      <div class="h3 mb-0"><%= stats.activeBookings %></div>
    </div>
  </div>
  <div class="col-md-3">
    <div class="card p-3">
      <div class="text-muted">Total Users</div>
      <div class="h3 mb-0"><%= stats.totalUsers %></div>
    </div>
  </div>
  <div class="col-md-3">
    <div class="card p-3">
      <div class="text-muted">Overdue</div>
      <div class="h3 mb-0 text-danger"><%= stats.overdueBookings %></div>
    </div>
  </div>
  
</div>

<div class="row g-3 mb-4">
  <div class="col-md-3">
    <div class="card p-3">
      <div class="text-muted">Requests Pending</div>
      <div class="h3 mb-0"><%= requestStats ? requestStats.pending : 0 %></div>
    </div>
  </div>
  <div class="col-md-3">
    <div class="card p-3">
      <div class="text-muted">Requests Approved</div>
      <div class="h3 mb-0"><%= requestStats ? requestStats.approved : 0 %></div>
    </div>
  </div>
  <div class="col-md-3">
    <div class="card p-3">
      <div class="text-muted">Requests Cancelled</div>
      <div class="h3 mb-0"><%= requestStats ? requestStats.cancelled : 0 %></div>
    </div>
  </div>
  <div class="col-md-3">
    <div class="card p-3">
      <div class="text-muted">Requests Rejected</div>
      <div class="h3 mb-0"><%= requestStats ? requestStats.rejected : 0 %></div>
    </div>
  </div>
  
</div>

<div class="row g-3 mb-4">
  <div class="col-md-6">
    <div class="card p-3">
      <div class="d-flex justify-content-between align-items-center">
        <div>
          <div class="text-muted">SOD</div>
          <div class="h5 mb-0"><%= sodUser ? sodUser.name : 'Not set' %></div>
        </div>
        <a class="btn btn-outline-primary btn-sm" href="/users">Manage</a>
      </div>
    </div>
  </div>
  <div class="col-md-6">
    <div class="card p-3">
      <div class="d-flex justify-content-between align-items-center">
        <div>
          <div class="text-muted">Key-B</div>
          <div class="h5 mb-0"><%= keybUser ? keybUser.name : 'Not set' %></div>
        </div>
        <a class="btn btn-outline-primary btn-sm" href="/users">Manage</a>
      </div>
    </div>
  </div>
  
</div>

<div class="card">
  <div class="card-body">
    <div class="d-flex justify-content-between align-items-center mb-3">
      <h5 class="mb-0">Recent Bookings</h5>
      <a href="/bookings" class="btn btn-sm btn-secondary">View all</a>
    </div>
    <div class="table-responsive">
      <table class="table align-middle">
        <thead>
          <tr>
            <th>ID</th>
            <th>User</th>
            <th>Start</th>
            <th>End</th>
            <th>Status</th>
            <th>Opener</th>
          </tr>
        </thead>
        <tbody>
          <% if (recentBookings && recentBookings.length) { %>
            <% recentBookings.forEach(b => { %>
              <tr>
                <td class="text-nowrap"><code><%= b.id %></code></td>
                <td><%= b.user ? b.user.name : 'Unknown' %></td>
                <td><%= formatDateTime(b.start) %></td>
                <td><%= formatDateTime(b.end) %></td>
                <td>
                  <span class="badge bg-<%= b.status === 'completed' ? 'success' : (b.status === 'active' ? 'primary' : (b.status === 'overdue' ? 'danger' : (b.status === 'cancelled' ? 'secondary' : 'warning'))) %>">
                    <%= b.status %>
                  </span>
                </td>
                <td><%= b.opener && b.opener.type ? b.opener.type.toUpperCase() : '-' %></td>
              </tr>
            <% }) %>
          <% } else { %>
            <tr><td colspan="6" class="text-center text-muted">No bookings found</td></tr>
          <% } %>
        </tbody>
      </table>
    </div>
  </div>
</div>
