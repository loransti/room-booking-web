<% title = 'Dashboard' %>
<v-row class="mb-6" align="center" justify="space-between">
  <v-col cols="12" md="6">
    <h2 class="mb-1">Dashboard</h2>
    <div class="text-medium-emphasis">Timezone: <%= process.env && process.env.TIMEZONE ? process.env.TIMEZONE : 'Configured' %></div>
  </v-col>
  <v-col cols="12" md="6" class="d-flex justify-end">
    <v-btn color="primary" href="/bookings" prepend-icon="mdi-view-list">View all bookings</v-btn>
  </v-col>
  
</v-row>

<v-row class="mb-6" dense>
  <v-col cols="12" sm="6" md="3">
    <v-card elevation="0" class="pa-4" border="md">
      <div class="text-medium-emphasis">Total Bookings</div>
      <div class="text-h4"><%= stats.totalBookings %></div>
    </v-card>
  </v-col>
  <v-col cols="12" sm="6" md="3">
    <v-card elevation="0" class="pa-4" border="md">
      <div class="text-medium-emphasis">Active/Upcoming</div>
      <div class="text-h4"><%= stats.activeBookings %></div>
    </v-card>
  </v-col>
  <v-col cols="12" sm="6" md="3">
    <v-card elevation="0" class="pa-4" border="md">
      <div class="text-medium-emphasis">Total Users</div>
      <div class="text-h4"><%= stats.totalUsers %></div>
    </v-card>
  </v-col>
  <v-col cols="12" sm="6" md="3">
    <v-card elevation="0" class="pa-4" border="md">
      <div class="text-medium-emphasis">Overdue</div>
      <div class="text-h4 text-error"><%= stats.overdueBookings %></div>
    </v-card>
  </v-col>
  
</v-row>

<v-row class="mb-6" dense>
  <v-col cols="12" md="6">
    <v-card elevation="0" class="pa-4" border="md">
      <div class="d-flex align-center justify-space-between">
        <div>
          <div class="text-medium-emphasis mb-1">SOD</div>
          <div class="text-h6"><%= sodUser ? sodUser.name : 'Not set' %></div>
        </div>
        <v-btn variant="tonal" color="primary" href="/users">Manage</v-btn>
      </div>
    </v-card>
  </v-col>
  <v-col cols="12" md="6">
    <v-card elevation="0" class="pa-4" border="md">
      <div class="d-flex align-center justify-space-between">
        <div>
          <div class="text-medium-emphasis mb-1">Keyâ€‘B</div>
          <div class="text-h6"><%= keybUser ? keybUser.name : 'Not set' %></div>
        </div>
        <v-btn variant="tonal" color="primary" href="/users">Manage</v-btn>
      </div>
    </v-card>
  </v-col>
  
</v-row>

<v-card elevation="0" border="md">
  <v-card-title class="d-flex align-center justify-space-between">
    <div>Recent Bookings</div>
    <v-btn size="small" variant="text" href="/bookings" prepend-icon="mdi-arrow-right">View all</v-btn>
  </v-card-title>
  <v-divider></v-divider>
  <v-card-text>
    <v-table density="comfortable">
      <thead>
        <tr>
          <th class="text-left">ID</th>
          <th class="text-left">User</th>
          <th class="text-left">Start</th>
          <th class="text-left">End</th>
          <th class="text-left">Status</th>
          <th class="text-left">Opener</th>
        </tr>
      </thead>
      <tbody>
        <% if (recentBookings && recentBookings.length) { %>
          <% recentBookings.forEach(b => { %>
            <tr>
              <td><code><%= b.id %></code></td>
              <td><%= b.user ? b.user.name : 'Unknown' %></td>
              <td><%= formatDateTime(b.start) %></td>
              <td><%= formatDateTime(b.end) %></td>
              <td><v-chip size="small" color="<%= b.status === 'completed' ? 'success' : (b.status === 'active' ? 'primary' : (b.status === 'overdue' ? 'error' : (b.status === 'cancelled' ? 'grey' : 'warning'))) %>" variant="tonal"><%= b.status %></v-chip></td>
              <td><%= b.opener && b.opener.type ? b.opener.type.toUpperCase() : '-' %></td>
            </tr>
          <% }) %>
        <% } else { %>
          <tr><td colspan="6" class="text-center text-medium-emphasis">No bookings found</td></tr>
        <% } %>
      </tbody>
    </v-table>
  </v-card-text>
</v-card>
