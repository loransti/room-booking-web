<% title = 'Calendar' %>
<v-row align="center" class="mb-4">
  <v-col cols="12" md="6"><h2 class="mb-0">Calendar</h2></v-col>
  <v-col cols="12" md="6" class="d-flex justify-end">
    <form method="get" class="d-inline-block">
      <v-text-field type="date" name="date" value="<%= selectedDate %>" density="comfortable" hide-details label="Select date" style="max-width: 240px"></v-text-field>
      <v-btn color="primary" type="submit" class="ml-2" prepend-icon="mdi-calendar">Go</v-btn>
    </form>
  </v-col>
</v-row>

<v-row>
  <v-col cols="12" lg="7">
    <v-card elevation="0" border="md" class="pa-2 pa-sm-4">
      <div class="text-medium-emphasis mb-3">Time Slots for <%= moment(selectedDate).format('DD.MM.YYYY') %></div>
      <v-list lines="two" class="py-0">
        <% timeSlots.forEach(slot => { %>
          <% const startSlot = moment(selectedDate + ' ' + String(slot.start).padStart(2,'0') + ':00'); %>
          <% const match = bookings.find(b => moment(b.start).isSame(startSlot, 'hour')); %>
          <v-list-item>
            <template #prepend>
              <v-avatar size="24" class="mr-3" color="<%= match ? (match.status === 'completed' ? 'success' : (match.status === 'active' ? 'primary' : (match.status === 'overdue' ? 'error' : (match.status === 'cancelled' ? 'grey' : 'warning')))) : 'success' %>" variant="tonal"></v-avatar>
            </template>
            <v-list-item-title><strong><%= slot.display %></strong></v-list-item-title>
            <v-list-item-subtitle>
              <% if (match) { %>
                <span><%= match.user ? match.user.name : 'Unknown' %></span>
                <span class="text-medium-emphasis ms-2"><%= formatDateTime(match.start) %> - <%= formatDateTime(match.end) %></span>
              <% } else { %>
                <span class="text-success">Available</span>
              <% } %>
            </v-list-item-subtitle>
            <template #append>
              <% if (match) { %>
                <v-chip size="small" color="<%= match.status === 'completed' ? 'success' : (match.status === 'active' ? 'primary' : (match.status === 'overdue' ? 'error' : (match.status === 'cancelled' ? 'grey' : 'warning'))) %>" variant="tonal"><%= match.status %></v-chip>
              <% } %>
            </template>
          </v-list-item>
          <v-divider></v-divider>
        <% }) %>
      </v-list>
    </v-card>
  </v-col>

  <v-col cols="12" lg="5">
    <v-card elevation="0" border="md" class="pa-2 pa-sm-4">
      <div class="text-medium-emphasis mb-3">Bookings on <%= moment(selectedDate).format('DD.MM.YYYY') %></div>
      <% if (bookings && bookings.length) { %>
        <v-list lines="two" class="py-0">
          <% bookings.forEach(b => { %>
            <v-list-item>
              <v-list-item-title><strong><%= b.user ? b.user.name : 'Unknown' %></strong></v-list-item-title>
              <v-list-item-subtitle class="text-medium-emphasis"><%= formatDateTime(b.start) %> - <%= formatDateTime(b.end) %></v-list-item-subtitle>
              <template #append>
                <v-chip size="small" color="<%= b.status === 'completed' ? 'success' : (b.status === 'active' ? 'primary' : (b.status === 'overdue' ? 'error' : (b.status === 'cancelled' ? 'grey' : 'warning'))) %>" variant="tonal"><%= b.status %></v-chip>
              </template>
            </v-list-item>
            <v-divider></v-divider>
          <% }) %>
        </v-list>
      <% } else { %>
        <div class="text-medium-emphasis">No bookings</div>
      <% } %>
    </v-card>
  </v-col>
</v-row>
